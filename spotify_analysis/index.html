

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Spotify Analysis - OG Home</title><meta name="Description" content="A End to End ELT data pipeline to Analyze Spotify Data and build recommendation system"><meta property="og:title" content="Spotify Analysis" />
<meta property="og:description" content="A End to End ELT data pipeline to Analyze Spotify Data and build recommendation system" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://phonghuynh.netlify.app/spotify_analysis/" /><meta property="og:image" content="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/spotify-diagram.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-10T18:41:00+07:00" />
<meta property="article:modified_time" content="2023-12-10T18:41:00+07:00" /><meta property="og:site_name" content="OG Home" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/spotify-diagram.png"/>

<meta name="twitter:title" content="Spotify Analysis"/>
<meta name="twitter:description" content="A End to End ELT data pipeline to Analyze Spotify Data and build recommendation system"/>
<meta name="application-name" content="OG">
<meta name="apple-mobile-web-app-title" content="OG">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://phonghuynh.netlify.app/spotify_analysis/" /><link rel="prev" href="https://phonghuynh.netlify.app/spotify_analysis_en/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Spotify Analysis",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/phonghuynh.netlify.app\/spotify_analysis\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/phonghuynh.netlify.app\/img\/oggy.png",
                            "width":  240 ,
                            "height":  240 
                        }],"genre": "posts","keywords": "streamlit, API, ELT, Data Engineer, Machine Learning, Distributed System, Hadoop, Spark, Docker, Terraform, Visualization, PowerBI","wordcount":  3046 ,
        "url": "https:\/\/phonghuynh.netlify.app\/spotify_analysis\/","datePublished": "2023-12-10T18:41:00+07:00","dateModified": "2023-12-10T18:41:00+07:00","publisher": {
            "@type": "Organization",
            "name": "OG Page","logo": "https:\/\/phonghuynh.netlify.app\/favicon.icon"},"authors": [{
                        "@type": "Person",
                        "name": "OG"                    
                    }],"description": "A End to End ELT data pipeline to Analyze Spotify Data and build recommendation system"
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="OG Home">OG Home</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/blogs/" title="OG&#39;s blogs"> Blogs </a><a class="menu-item" href="/projects/" title="OG&#39;s Projects"> Projects </a><a class="menu-item" href="/tags/" title="Tags of blogs"> Tags </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://drive.google.com/file/d/1jIJxzyFMc7zy78tsBJc7ShFyV8sQTBS7/view?usp=sharing" title="Resume" rel="noopener noreferrer" target="_blank"> Resume üîó </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="OG Home">OG Home</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/blogs/" title="OG&#39;s blogs">Blogs</a><a class="menu-item" href="/projects/" title="OG&#39;s Projects">Projects</a><a class="menu-item" href="/tags/" title="Tags of blogs">Tags</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://drive.google.com/file/d/1jIJxzyFMc7zy78tsBJc7ShFyV8sQTBS7/view?usp=sharing" title="Resume" rel="noopener noreferrer" target="_blank">Resume üîó</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content always-active" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#data-schema">Data Schema</a></li>
    <li><a href="#infrastructure">Infrastructure</a>
      <ul>
        <li><a href="#apache-hadoop">Apache Hadoop</a></li>
        <li><a href="#prefect">Prefect</a></li>
        <li><a href="#dremio">Dremio</a></li>
        <li><a href="#mongodb-with-terraform">MongoDB with Terraform</a></li>
      </ul>
    </li>
    <li><a href="#pipeline-1">Pipeline 1</a></li>
    <li><a href="#pipeline-2">Pipeline 2</a>
      <ul>
        <li><a href="#pyspark">PySpark</a></li>
        <li><a href="#data-processing">Data Processing</a></li>
      </ul>
    </li>
    <li><a href="#analytic-layer">Analytic layer</a></li>
    <li><a href="#machine-learning-and-dashboard">Machine learning and Dashboard</a>
      <ul>
        <li><a href="#k-nearest-neighbors-knn">K-Nearest Neighbors (KNN)</a></li>
        <li><a href="#powerbi-dashboard">PowerBI Dashboard</a></li>
      </ul>
    </li>
    <li><a href="#application">Application</a></li>
    <li><a href="#final-thoughts">Final Thoughts</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Spotify Analysis</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><span class="author fas fa-user-circle fa-fw"></span><span class='screen-reader-text'>  </span><a href='https://phonghuynh.netlify.app/authors/og'>OG</a></span>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/projects/"><i class="far fa-folder fa-fw"></i>projects</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="10 Dec 2023">10 Dec 2023</time>&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;15 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="/img/project-spotify.jpg"
        srcset="/img/project-spotify.jpg, /img/project-spotify.jpg 1.5x, /img/project-spotify.jpg 2x"
        sizes="auto"
        alt="A End to End ELT data pipeline to Analyze Spotify Data and build recommendation system"
        title="A End to End ELT data pipeline to Analyze Spotify Data and build recommendation system" height="auto"   width="auto" ></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#data-schema">Data Schema</a></li>
    <li><a href="#infrastructure">Infrastructure</a>
      <ul>
        <li><a href="#apache-hadoop">Apache Hadoop</a></li>
        <li><a href="#prefect">Prefect</a></li>
        <li><a href="#dremio">Dremio</a></li>
        <li><a href="#mongodb-with-terraform">MongoDB with Terraform</a></li>
      </ul>
    </li>
    <li><a href="#pipeline-1">Pipeline 1</a></li>
    <li><a href="#pipeline-2">Pipeline 2</a>
      <ul>
        <li><a href="#pyspark">PySpark</a></li>
        <li><a href="#data-processing">Data Processing</a></li>
      </ul>
    </li>
    <li><a href="#analytic-layer">Analytic layer</a></li>
    <li><a href="#machine-learning-and-dashboard">Machine learning and Dashboard</a>
      <ul>
        <li><a href="#k-nearest-neighbors-knn">K-Nearest Neighbors (KNN)</a></li>
        <li><a href="#powerbi-dashboard">PowerBI Dashboard</a></li>
      </ul>
    </li>
    <li><a href="#application">Application</a></li>
    <li><a href="#final-thoughts">Final Thoughts</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div class="details admonition success open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-check-circle fa-fw"></i>Shout out cho nh·ªØng member t√¢m huy·∫øt<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Project n√†y c√≥ th·ªÉ ho√†n thi·ªán c≈©ng l√† s·ª± ƒë√≥ng g√≥p c·ªßa c√°c th√†nh vi√™n trong team: Ng·ªçc Tu·∫•n (Data Engineer), Duy S∆°n (Data Scientist), Vƒ© Thi√™n (Data Analyst)</div>
        </div>
    </div>
<a target="_blank" href="https://github.com/PhongHuynh0394/Spotify-Analysis-with-PySpark" title="PhongHuynh0394" class="friend-link" rel="noopener noreferrer">
    <div class="friend-link-div">
        <div class="friend-link-avatar"><img
        
        loading="lazy"
        src="/img/github-logo.png"
        srcset="/img/github-logo.png, /img/github-logo.png 1.5x, /img/github-logo.png 2x"
        sizes="auto"
        alt="/img/github-logo.png"
        title="/img/github-logo.png" height="560"   width="560" ></div>
        <div class="friend-link-info">
            <div class="friend-name-div">
                <i class="fas fa-user-circle fa-fw"></i>
                <i class="friend-name">PhongHuynh0394</i>
            </div>
            <p class="friend-bio">Spotify Analysis with PySpark</p>
        </div>
    </div>
</a>
<p><strong><a href="/spotify_analysis_en/" rel="">English Version Available</a></strong></p>
<p>Hello ! Hello ! L·∫°i l√† OG ƒë√¢y. L·∫ßn n√†y m√¨nh s·∫Ω c√πng nhau x√¢y d·ª±ng
End-to-End ELT data pipeline v√† m·ªôt Recommender System d·ª±a tr√™n d·ªØ li·ªáu ph√¢n t√≠ch t·ª´ Spotify API nh√©.
Kh√¥ng d√†i d√≤ng n·ªØa, b·∫Øt ƒë·∫ßu th√¥i n√†o.</p>
<h2 id="introduction" class="headerLink">
    <a href="#introduction" class="header-mark"></a>Introduction</h2><p>Project l·∫ßn n√†y l√† x√¢y d·ª±ng h·ªá th·ªëng ph√¢n t√≠ch nh·∫°c t·ª´ Spotify nh∆∞ diagram sau</p>
<figure><img src="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/spotify-diagram.png"/>
</figure>

<p>Trong diagram bao g·ªìm nh·ªØng th√†nh ph·∫ßn sau:</p>
<ol>
<li><a href="#infrastructure" rel=""><strong>Infrastructure</strong></a>: Ta s·∫Ω s·ª≠ d·ª•ng Docker ƒë·ªÉ set up cho h·∫ßu h·∫øt c√°c frameworks s·ª≠ d·ª•ng trong h·ªá th·ªëng v√† Terraform (Optional) ƒë·ªÉ set up cho MongoDB.</li>
<li><a href="#pipeline-1" rel=""><strong>Pipeline 1</strong></a>: ƒê√¢y l√† pipeline s·∫Ω th·ª±c hi·ªán incremental load v√†o MongoDB m·ªói k√©o data t·ª´ Spotify API v·ªÅ.</li>
<li><a href="#pipeline-2" rel=""><strong>Pipeline 2</strong></a>: Data Pipeline n√†y th·ª±c hi·ªán vi·ªác ch√≠nh l√† ELT (Extract, Load, Transform) ƒë·ªÉ x·ª≠ l√Ω v√† chu·∫©n h√≥a d·ªØ li·ªáu JSON t·ª´ MongoDB. Vi·ªác x·ª≠ l√Ω c·∫•u tr√∫c d·ªØ li·ªáu ph·ª©c t·∫°p v√† l·ªìng nhau c·ªßa JSON ch·ªß y·∫øu s·∫Ω ƒë∆∞·ª£c th·ª±c hi·ªán b·∫±ng pySpark (Python API c·ªßa Apache Spark) ngay tr√™n HDFS (Hadoop Distributed File System)</li>
<li><a href="#analytic-layer" rel=""><strong>Analytic Layer</strong></a>: ƒê·ªÉ c√≥ th·ªÉ s·ª≠ d·ª•ng ph√¢n t√≠ch ƒë∆∞·ª£c, ta s·∫Ω apply m·ªôt l·ªõp ph√¢n t√≠ch l√™n tr√™n Hadoop. ·ªû project n√†y ta s·∫Ω s·ª≠ d·ª•ng Dremio ƒë·ªÉ cho vi·ªác ƒë√≥.</li>
<li><a href="#machine-learning-and-dashboard" rel=""><strong>Machine learning and Dashboard</strong></a>: ·ªû ph·∫ßn n√†y ch·ªß y·∫øu l√† vi·ªác training m√¥ h√¨nh machine learning model cho h·ªá th·ªëng g·ª£i √Ω √¢m nh·∫°c spoitfy. Ngo√†i ra c≈©ng c√≥ th·ªÉ PowerBI ƒë·ªÉ t·∫°o c√°c Dashboard ƒë·ªÉ ph√¢n t√≠ch t·ª´ d·ªØ li·ªáu ·ªü Dremio.</li>
<li><a href="#application" rel=""><strong>Application</strong></a>: Cu·ªëi c√πng ta s·∫Ω d√πng Streamlit ƒë·ªÉ vi·∫øt m·ªôt web ƒë∆°n gi·∫£n ƒë·ªÉ l√†m h·ªá th·ªëng g·ª£i √Ω v√† t√¨m ki·∫øm nh·∫°c. Ngo√†i ra ng∆∞·ªùi d√πng c≈©ng c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi BI Dashboard ·ªü layer n√†y</li>
</ol>
<h2 id="data-schema" class="headerLink">
    <a href="#data-schema" class="header-mark"></a>Data Schema</h2><p>Ngu·ªìn data c·ªßa ch√∫ng ta ƒë·∫øn t·ª´ <a href="https://developer.spotify.com/documentation/web-api" target="_blank" rel="noopener noreferrer">Spotify API</a>. Ngo√†i ra ta c≈©ng s·∫Ω c√†o th√™m m·ªôt danh s√°ch
ngh·ªá sƒ© tr√™n Spotify t·ª´ trang <a href="https://kworb.net/spotify/artists.html#google_vignette" target="_blank" rel="noopener noreferrer">Sportify Artists</a>. Data sau khi ƒë√£ ƒë∆∞·ª£c
x·ª≠ l√Ω cu·ªëi c√πng s·∫Ω c√≥ schema nh∆∞ sau:</p>
<figure><img src="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/schema.png"/>
</figure>

<h2 id="infrastructure" class="headerLink">
    <a href="#infrastructure" class="header-mark"></a>Infrastructure</h2><p>Ta s·∫Ω s·ª≠ d·ª•ng ch·ªß y·∫øu l√† Docker ƒë·ªÉ c·∫•u h√¨nh cho h·∫ßu h·∫øt c√°c framework trong h·ªá th·ªëng th√¥ng qua <code>docker-compose.yml</code> file. Ch·ªâ ri√™ng c√≥ MongoDB Atlas th√¨ c√≥ th·ªÉ set up b·∫±ng nhi·ªÅu c√°ch kh√°c nhau.</p>
<h3 id="apache-hadoop" class="headerLink">
    <a href="#apache-hadoop" class="header-mark"></a>Apache Hadoop</h3><p>ƒê·∫ßu ti√™n ta s·∫Ω set up Apache Hadoop b·∫±ng Docker Compose. Nh∆∞ ƒë√£ bi·∫øt Hadoop l√† m·ªôt framework ƒë∆∞·ª£c vi·∫øt b·∫±ng Java ƒë∆∞·ª£c gi·ªõi thi·ªáu b·ªüi Google v√†o nƒÉm 2006 v√† ·ª©ng d·ª•ng c√¥ng ngh·ªá h·ªá th·ªëng
ph√¢n t√°n ƒë·ªÉ l∆∞u tr·ªØ v√† x·ª≠ l√Ω Big Data. Hadoop ƒë∆∞·ª£c x√¢y d·ª±ng ƒë·ª±a tr√™n ba th√†nh ph·∫ßn ch√≠nh:</p>
<ol>
<li><strong>HDFS (Hadoop Distributed File System)</strong>: l√† h·ªá th·ªëng file ph√¢n t√°n ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu</li>
<li><strong>YARN (Yet Another Resouce Negotiator)</strong>: l√† m·ªôt framework qu·∫£n l√Ω v√† ph√¢n b·ªï t√†i nguy√™n ƒë·ªÉ v·∫≠n h√†nh c√°c ·ª©ng d·ª•ng tr√™n Hadoop</li>
<li><strong>MapReduce</strong>: l√† m·ªôt framework l·∫≠p tr√¨nh x·ª≠ l√Ω v√† t√≠nh to√°n d·ªØ li·ªáu song song trong m√¥i tr∆∞·ªùng h·ªá th·ªëng ph√¢n t√°n.</li>
</ol>
<figure><img src="https://i.imgur.com/6svuJjx.jpeg"/><figcaption>
            <h4>HDFS v√† YARN trong Hadoop</h4>
        </figcaption>
</figure>

<p>Trong project n√†y, ta s·∫Ω l∆∞·ª£t b·ªõt ph·∫ßn setup MapReduce trong Hadoop Cluster v√† thay v√†o ƒë√≥ ch·ªâ l√† HDFS v√† YARN th√¥i (v√¨ ph·∫ßn x·ª≠ l√Ω t√≠nh to√°n ta s·∫Ω thay th·∫ø b·∫±ng Apache Spark).
Ngo√†i ra v√¨ l√† project PoC (Proof of Concept), ta s·∫Ω ƒë∆°n gi·∫£n h√≥a Hadoop cluster v·ªõi 1 Master Node, 1 Worker Node m√† th√¥i.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hadoop_datanode</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">hadoop_namenode</span><span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">namenode</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">namenode</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">apache/hadoop:3</span><span class="w">
</span><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">namenode</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">bash -c &#34;if [ ! -f /tmp/hadoop-root/dfs/name/.formatted ]; then hdfs namenode -format &amp;&amp; touch /tmp/hadoop-root/dfs/name/.formatted; fi &amp;&amp; hdfs namenode&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">9870</span><span class="p">:</span><span class="m">9870</span><span class="w">
</span><span class="w">      </span>- <span class="m">8020</span><span class="p">:</span><span class="m">8020</span><span class="w">
</span><span class="w">      </span>- <span class="m">9000</span><span class="p">:</span><span class="m">9000</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">.env</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">hadoop_namenode:/tmp/hadoop-root/dfs/name</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">docker-net</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">datanode</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">apache/hadoop:3</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">datanode</span><span class="w">
</span><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">datanode </span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;hdfs&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;datanode&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">9864</span><span class="p">:</span><span class="m">9864</span><span class="w">
</span><span class="w">      </span>- <span class="m">9866</span><span class="p">:</span><span class="m">9866</span><span class="w">
</span><span class="w">    </span><span class="nt">expose</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">50010</span><span class="w">
</span><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">.env</span><span class="w">
</span><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">hadoop_datanode:/tmp/hadoop-root/dfs/data</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">docker-net</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">resourcemanager</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">apache/hadoop:3</span><span class="w">
</span><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">resourcemanager</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;yarn&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;resourcemanager&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">       </span>- <span class="m">8088</span><span class="p">:</span><span class="m">8088</span><span class="w">
</span><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">.env</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">./test.sh:/opt/test.sh</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">docker-net</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">nodemanager</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">apache/hadoop:3</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;yarn&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;nodemanager&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">.env</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">8188</span><span class="p">:</span><span class="m">8188</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">docker-net</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Ta s·∫Ω ch·ªß y·∫øu s·ª≠ d·ª•ng HDFS ƒë·ªÉ l√†m Datalake cho project n√†y. Ngo√†i ra c√≥ th·ªÉ truy c·∫≠p v√†o c√°c services c·ªßa Hadoop th√¥ng qua:</p>
<ul>
<li>Namenode: <code>localhost:9870</code></li>
<li>Datanode: <code>localhost:9864</code></li>
<li>Resouces Manager (YARN): <code>localhost:8088</code></li>
</ul>
<h3 id="prefect" class="headerLink">
    <a href="#prefect" class="header-mark"></a>Prefect</h3><p>Prefect l√† m·ªôt orchestration tool kh√° d·ªÖ d√πng v√† d·ªÖ b·∫Øt ƒë·∫ßu. V·ªõi giao di·ªán b·∫Øt m·∫Øt v√† t√≠nh d·ªÖ ti·∫øp c·∫≠n, framework n√†y gi√∫p cho vi·ªác
l√™n l·ªãch, s·∫Øp x·∫øp v√† ch·∫°y c√°c task hay th·∫≠m ch√≠ l√† ch·∫°y song song (concurrent task). Ta s·∫Ω set up m·ªôt prefect server v√† prefect API b·∫±ng docker nh∆∞ sau:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="w">  </span><span class="nt">prefect-server</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l">./prefect</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">prefect</span><span class="w">
</span><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">prefect-server</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">prefect-server</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">prefect:/root/.prefect</span><span class="w">
</span><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">prefect server start</span><span class="w">
</span><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">PREFECT_UI_URL=http://127.0.0.1:4200/api</span><span class="w">
</span><span class="w">      </span>- <span class="l">PREFECT_API_URL=http://127.0.0.1:4200/api</span><span class="w">
</span><span class="w">      </span>- <span class="l">PREFECT_SERVER_API_HOST=0.0.0.0</span><span class="w">
</span><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">4200</span><span class="p">:</span><span class="m">4200</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">docker-net</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="nt">prefect</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">prefect:latest</span><span class="w">
</span><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">prefect</span><span class="w">
</span><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;./prefect/flows:/opt/prefect/flows&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;/etc/timezone:/etc/timezone:ro&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="s2">&#34;/etc/localtime:/etc/localtime:ro&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">.env</span><span class="w">
</span><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">docker-net</span><span class="w">
</span><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">prefect-server</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><figure><img src="https://i.imgur.com/x5kovYF.jpeg"/>
</figure>

<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>T·∫°i sao l·∫°i set up Prefect Server v√† Prefect ri√™ng v·ªõi nhau ?<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">C√≥ nhi·ªÅu l√Ω do ƒë·ªÉ ch·ªçn set up ri√™ng Prefect Server v√† Prefect ri√™ng bi·ªát, nh∆∞ng th∆∞·ªùng l√Ω do quan tr·ªçng nh·∫•t l√† ta mu·ªën t√πy ch·ªânh
m√¥i tr∆∞·ªùng ch·∫°y flow m√† kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn server. Prefect Server s·∫Ω ƒë√≥ng vai tr√≤ Backend x·ª≠ l√Ω c√°c t√≠n hi·ªáu t·ª´ c√°c container kh√°c th√¥ng qua prefect API. ƒêi·ªÅu n√†y gi√∫p tƒÉng t√≠nh ·ªïn ƒë·ªãnh cho h·ªá
th·ªëng v√† d·ªÖ ƒë·ªÉ b·∫£o tr√¨, debug.</div>
        </div>
    </div></p>
<p>V√† trong l√∫c setup, ta s·∫Ω kh√¥ng s·ª≠ d·ª•ng built-in image <a href="https://hub.docker.com/r/prefecthq/prefect" target="_blank" rel="noopener noreferrer">PrefectHQ</a> m√† thay v√†o ƒë√≥ s·∫Ω t·ª± build m·ªôt custom image ƒë·ªÉ c√≥ th·ªÉ d·ªÖ t√πy bi·∫øn. Ngo√†i c√°c module cho python
trong <code>requirements.txt</code> ta s·∫Ω c·∫ßn ph·∫£i config th√™m Java 11 ƒë·ªÉ t∆∞∆°ng th√≠ch v·ªõi pyspark</p>
<div class="highlight" title="Dockerfile"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="k">ARG</span> <span class="nv">IMAGE_VARIANT</span><span class="o">=</span>slim-buster<span class="err">
</span><span class="err"></span><span class="k">ARG</span> <span class="nv">OPENJDK_VERSION</span><span class="o">=</span><span class="m">11</span>
<span class="k">ARG</span> <span class="nv">PYTHON_VERSION</span><span class="o">=</span><span class="m">3</span>.11.0<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">FROM</span><span class="s"> python:${PYTHON_VERSION}-${IMAGE_VARIANT} AS py3</span><span class="err">
</span><span class="err"></span><span class="k">FROM</span><span class="s"> openjdk:${OPENJDK_VERSION}-${IMAGE_VARIANT}</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>py3 / /<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /opt/prefect</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> requirements.txt .<span class="err">
</span><span class="err"></span><span class="k">RUN</span> pip install -r requirements.txt --trusted-host pypi.python.org --no-cache-dir<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="k">COPY</span> flows /opt/prefect/flows<span class="err">
</span><span class="err">
</span><span class="err"></span><span class="c"># Run our flow script when the container starts</span><span class="err">
</span><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;flows/main_flow.py&#34;</span><span class="p">]</span><span class="err">
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Ta c√≥ th·ªÉ truy c·∫≠p UI Prefect th√¥ng qua <code>localhost:4042</code> ƒë·ªÉ trigger pipeline.</p>
</blockquote>
<h3 id="dremio" class="headerLink">
    <a href="#dremio" class="header-mark"></a>Dremio</h3><p>B√¢y gi·ªù ta ƒë√£ c√≥ m·ªôt datalake l√† hadoop HDFS, tuy nhi√™n Object Storange nh∆∞ HDFS kh√¥ng cung c·∫•p kh·∫£ nƒÉng ph√¢n t√≠ch hay truy v·∫•n, do ƒë√≥ ta s·∫Ω c·∫ßn x√¢y d·ª±ng m·ªôt Analytic Layer tr√™n HDFS. ·ªû v·ªã tr√≠ n√†y c√≥ kh√° nhi·ªÅu l·ª±a ch·ªçn nh∆∞ Trino, Hive,&hellip; Tuy nhi√™n ·ªü project n√†y ta s·∫Ω d√πng
m·ªôt Lakehouse platform l√† Dremio.</p>
<p>Dremio l√† m·ªôt m√£ ngu·ªìn m·ªü data-as-a-service h·ªó tr·ª£ ph√¢n t√≠ch v√† d·ªÖ d√†ng k·∫øt n·ªëi v·ªõi ƒëa d·∫°ng ngu·ªìn data kh√°c nhau v√† t·∫•t nhi√™n trong ƒë√≥ c√≥ Hadoop. Dremio cung c·∫•p kh·∫£ truy v·∫•n m·∫°nh m·∫Ω
v·ªõi SQL engine v√† m·ªôt giao di·ªán th√¢n thi·ªán</p>
<figure><img src="https://docs.dremio.com/assets/images/simple-arch-f14219fc3923321c4f39dab0fd8cb002.png"/><figcaption>
            <h4>Dremio Cluster</h4>
        </figcaption>
</figure>

<p>Ta s·∫Ω config m·ªôt dremio cluster v·ªõi <a href="https://hub.docker.com/r/dremio/dremio-oss" target="_blank" rel="noopener noreferrer">dremio-oss</a> image. Image n√†y bao g·ªìm:</p>
<ul>
<li>Embedded Zookeeper</li>
<li>Master Coordinator</li>
<li>Execuor</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="nt">dremio</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">dremio/dremio-oss</span><span class="w">
</span><span class="w">  </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">dremio</span><span class="w">
</span><span class="w">  </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">dremio</span><span class="w">
</span><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span><span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="l">dremio_data:/var/lib/dremio</span><span class="w">
</span><span class="w">    </span>- <span class="l">dremio_data:/localFiles</span><span class="w">
</span><span class="w">    </span>- <span class="l">dremio_data:/opt/dremio</span><span class="w">
</span><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;9047:9047&#34;</span><span class="w">   </span><span class="c"># Web UI (HTTP)</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;31010:31010&#34;</span><span class="w"> </span><span class="c"># ODBC/JDBC client</span><span class="w">
</span><span class="w">    </span>- <span class="s2">&#34;32010:32010&#34;</span><span class="w"> </span><span class="c"># Apache Arrow Flight clients</span><span class="w">
</span><span class="w">  </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="l">docker-net</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Sau khi deploy th√†nh c√¥ng, ta c√≥ th·ªÉ ƒëƒÉng nh·∫≠p v√†o dremio ·ªü <code>localhost:9047</code> v·ªõi username=dremio v√† password=dremio123</p>
</blockquote>
<h3 id="mongodb-with-terraform" class="headerLink">
    <a href="#mongodb-with-terraform" class="header-mark"></a>MongoDB with Terraform</h3><div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw"></i>Warning<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">·ªû b∆∞·ªõc set up n√†y c·∫ßn ph·∫£i ƒëƒÉng k√Ω <a href="https://www.mongodb.com/cloud/atlas/register" target="_blank" rel="noopener noreferrer">t√†i kho·∫£n MongoDB Atlas</a> v√† c√†i ƒë·∫∑t <a href="https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli" target="_blank" rel="noopener noreferrer">Terraform</a></div>
        </div>
    </div>
<p><strong>V·ªÅ Terraform</strong>: HashiCorp Terraform l√† m·ªôt c√¥ng c·ª• &ldquo;insfrastructure as code&rdquo; gi√∫p ta setup v√† config nh·ªØng t√†i nguy√™n c·∫£ on-prem hay cloud ch·ªâ v·ªõi vi·ªác vi·∫øt configuration file.</p>
<p><strong>MongoDB Atlas</strong>: c√≥ th·ªÉ kh√¥ng c·∫ßn config trong docker compose v√† ho√†n to√†n c√≥ th·ªÉ set up th·ªß c√¥ng ·ªü <a href="https://www.mongodb.com/products/platform/atlas-database" target="_blank" rel="noopener noreferrer">ƒê√¢y</a>. Tuy nhi√™n trong ph·∫ßn n√†y th√¨ ta s·∫Ω
l√†m ƒëi·ªÅu ƒë√≥ t·ª± ƒë·ªông b·∫±ng Terraform.</p>
<figure><img src="https://webassets.mongodb.com/_com_assets/cms/Screenshot%202024-01-04%20at%209.03.59%E2%80%AFAM-38glhpd7xa.png"/>
</figure>

<p>ƒê·∫ßu ti√™n ta c√†n ph·∫£i c√≥ t√†i kho·∫£n MongoDB Atlas, sau ƒë√≥ b∆∞·ªõc ƒë·∫ßu ti√™n l√† s·∫Ω set up v√†i variables trong file <code>variable.tf</code>. File n√†y s·∫Ω l∆∞u ƒëa s·ªë c√°c bi·∫øn m√¥i tr∆∞·ªùng, API key, token,&hellip;.
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>Note<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Chi ti·∫øt c√°ch set up file <code>variable.tf</code> c√≥ th·ªÉ ƒë·ªçc ·ªü <a href="https://github.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/tree/main/mongo_terraform" target="_blank" rel="noopener noreferrer">ƒê√¢y</a></div>
        </div>
    </div></p>
<p>V·ªõi terraform, ta s·∫Ω ch·ªß y·∫øu ch·∫°y file <code>main.tf</code> v√¨ file n√†y s·∫Ω l∆∞u m·ªçi config v·ªÅ cluster mu·ªën deploy.</p>
<p>Ta s·∫Ω s·ª≠ d·ª•ng <a href="https://registry.terraform.io/providers/mongodb/mongodbatlas/latest" target="_blank" rel="noopener noreferrer">MongoDB Atlas Provider</a> v√† g·ªçi l·∫°i c√°c variables (ƒë∆∞·ª£c set trong file file <code>variable.tf</code> tr∆∞·ªõc ƒë√≥)</p>
<div class="highlight" title="main.tf"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HCL" data-lang="HCL"><span class="k">terraform</span> {
  <span class="k">required_providers</span> {
<span class="n">    mongodbatlas</span> <span class="o">=</span> {
<span class="n">      source</span> <span class="o">=</span> <span class="s2">&#34;mongodb/mongodbatlas&#34;</span><span class="p">,</span>
<span class="n">      version</span> <span class="o">=</span> <span class="s2">&#34;1.8.0&#34;</span>
    }
  }
}

<span class="k">provider</span> <span class="s2">&#34;mongodbatlas&#34;</span> {
<span class="n">  public_key</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">public_key</span>
<span class="n">  private_key</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">private_ke</span>
}
</code></pre></td></tr></table>
</div>
</div><p><div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Chi ti·∫øt c√°c resources c√≥ th·ªÉ tham kh·∫£o t·∫°i ƒë√¢y <a href="https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs" target="_blank" rel="noopener noreferrer">mongodbatlas Provider terraform docs</a></div>
        </div>
    </div>
Ngo√†i ra ta c≈©ng s·∫Ω t·∫°o m·ªôt v√†i resources kh√°c ƒë·ªÉ ho√†n thi·ªán ph·∫ßn setting up:</p>
<ul>
<li><code>mongdodbatlas_project</code>: Config project kh·ªèi t·∫°o</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="k">resource</span> <span class="s2">&#34;mongodbatlas_project&#34; &#34;spotify_project&#34;</span> {
<span class="n">  name</span> <span class="o">=</span> <span class="s2">&#34;spotify_project&#34;</span>
<span class="n">  org_id</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">org_id</span>
<span class="n">  is_collect_database_specifics_statistics_enabled</span> <span class="o">=</span> <span class="kt">true</span>
<span class="n">  is_data_explorer_enabled</span> <span class="o">=</span> <span class="kt">true</span>
<span class="n">  is_performance_advisor_enabled</span> <span class="o">=</span> <span class="kt">true</span>
<span class="n">  is_realtime_performance_panel_enabled</span> <span class="o">=</span> <span class="kt">true</span>
<span class="n">  is_schema_advisor_enabled</span> <span class="o">=</span> <span class="kt">true</span>
}
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>mongodbatlas_cluster</code>: setup cluster cho atlas, ta s·∫Ω host tr√™n gcp (c√≥ th·ªÉ ch·ªçn azure hay aws ƒë·ªÅu ƒë∆∞·ª£c)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="k">resource</span> <span class="s2">&#34;mongodbatlas_cluster&#34; &#34;spotify&#34;</span> {
<span class="n">  name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">cluster_name</span>
<span class="n">  project_id</span> <span class="o">=</span> <span class="k">mongodbatlas_project</span><span class="p">.</span><span class="k">spotify_project</span><span class="p">.</span><span class="k">id</span>
<span class="n">  backing_provider_name</span> <span class="o">=</span> <span class="s2">&#34;GCP&#34;</span>
<span class="n">  provider_name</span> <span class="o">=</span> <span class="s2">&#34;TENANT&#34;</span>
<span class="n">  provider_instance_size_name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">cluster_size</span>
<span class="n">  provider_region_name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">region</span>
}
</code></pre></td></tr></table>
</div>
</div><p><strong>Ch·∫°y l·ªánh deploy cluster</strong></p>
<p>Sau khi ƒë√£ chu·∫©n b·ªã ho√†n t·∫•t c√°c configuration, vi·ªác c√≤n l·∫°i l√† ch·∫°y c√°c l·ªánh tf cli ƒë·ªÉ set up plan</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">terraform init <span class="c1"># set up provider for atlas</span>
terraform plan
</code></pre></td></tr></table>
</div>
</div><p>Sau ƒë√≥, nh·∫≠p <code>yes</code> ƒë·ªÉ ti·∫øp t·ª•c qu√° tr√¨nh set up. cu·ªëi d√πng ƒë·ªÉ deploy cluster th√¨ ta s·∫Ω ch·ªâ c·∫ßn nh·∫≠p <code>terraform apply</code>. sau ƒë√≥ ta s·∫Ω nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£ gi·ªëng th·∫ø n√†y</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">Apply complete! Resources: <span class="m">4</span> added, <span class="m">0</span> changed, <span class="m">0</span> destroyed.

Outputs:

<span class="nv">password</span> <span class="o">=</span> <span class="s2">&#34;123&#34;</span>
<span class="nv">srv_address</span> <span class="o">=</span> <span class="s2">&#34;mongodb+srv://spotify-cluster.kdglyul.mongodb.net&#34;</span>
<span class="nv">user</span> <span class="o">=</span> <span class="s2">&#34;root&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>H√£y ch√∫ √Ω c√°c th√¥ng tin ·ªü ba d√≤ng cu·ªëi l√† password, srv_address v√† user. ta s·∫Ω c·∫ßn nh·ªØng th√¥ng tin n√†y cho file <code>.env</code> ƒë·ªÉ set up connection v·ªõi Atlas sau n√†y. ƒê√≥ s·∫Ω l√† c√°c bi·∫øn <code>MONGODB_PASS</code>, <code>MONGODB_SRV</code> v√† <code>MONGODB_USER</code></p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">ƒê·ªÉ x√≥a m·ªçi th·ª© tr√™n mongodb atlas k·ªÉ c·∫£ cluster th√¨ ch·ªâ c·∫ßn ch·∫°y l·ªánh <code>terraform destroy</code>. h√£y c·∫©n th·∫≠n v√¨ l·ªánh n√†y c√≥ th·ªÉ x√≥a h·∫øt cluster v√† c·∫£ data</div>
        </div>
    </div>
<h2 id="pipeline-1" class="headerLink">
    <a href="#pipeline-1" class="header-mark"></a>Pipeline 1</h2><p>Data pipeline n√†y th·ª±c hi·ªán vi·ªác ch√≠nh l√† pooling api ƒë·ªÉ crawl data t·ª´ spotify api v√† incremental load data v√†o mongodb atlas. ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ
v·ªÅ rate limit, ta s·∫Ω config cho flow n√†y ƒë∆∞·ª£c t·ª± ƒë·ªông trigger m·ªói 2 ph√∫t 5 gi√¢y ƒë·ªÉ crawl m·ªôt batch g·ªìm l·∫ßn l∆∞·ª£t th√¥ng tin 5 artists t·ª´ file danh s√°ch <code>artists.txt</code></p>
<figure><img src="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/main/image/pipline1-b.jpg"/>
</figure>

<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>Incremental load<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Kh√°c v·ªõi full load khi ta load data v√† overwrite t·∫•t c·∫£ trong database , incremental load hay ƒë∆∞·ª£c g·ªçi l√† delta load th·ª±c hi·ªán vi·ªác
ch·ªâ load ph·∫ßn data update ho·∫∑c data m·ªõi m√† kh√¥ng load l·∫°i t·∫•t c·∫£ c√°c historical data tr∆∞·ªõc ƒë√≥. pipeline n√†y s·∫Ω lu√¥n c√†o v√† ingest th√¥ng tin ngh·ªá sƒ© m·ªõi nh·∫•t trong file <code>artists.txt</code> ƒë·ªÉ g·ªçi spotify api qua m·ªói batch
v√† d√πng m·ªôt file <code>log.txt</code> ƒë·ªÉ ƒë√°nh d·∫•u v·ªã tr√≠ index v√† s·ªë l∆∞·ª£ng ngh·ªá sƒ© ƒë√£ c√†o th√†nh c√¥ng</div>
        </div>
    </div>
<h2 id="pipeline-2" class="headerLink">
    <a href="#pipeline-2" class="header-mark"></a>Pipeline 2</h2><p>ƒê√¢y l√† ph·∫ßn ch√≠nh c·ªßa project n√†y v√† h·∫ßu h·∫øt c√°c t√°c v·ª• x·ª≠ l√Ω s·∫Ω th·ª±c hi·ªán trong pipeline n√†y. Pipeline n√†y ch√≠nh l√† m·ªôt ELT (Extract - Load - Transform) data pipeline
v·ªõi ngu·ªìn raw l√† c√°c collections t·ª´ MongoDB, sau ƒë√≥ s·∫Ω ƒë∆∞·ª£c x·ª≠ l√Ω b·∫±ng spark v√† l∆∞u trong hdfs. Ta ƒë·ªìng th·ªùi s·∫Ω x√¢y d·ª±ng m·ªôt <strong>Medallion architecture</strong> ngay trong hdfs ƒë·ªÉ ph√¢n v√πng cho c√°c lo·∫°i data.</p>
<div class="details admonition info">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-info-circle fa-fw"></i>Medallion architecture<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>ki·∫øn tr√∫c n√†y ƒë∆∞·ª£c Databricks gi·ªõi thi·ªáu l√† m·ªôt &ldquo;data design pattern&rdquo; d√πng ƒë·ªÉ t·ªï ch·ª©c data trong lakehouse v·ªõi m·ª•c ti√™u l√† ƒë·ªÉ
c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng data qua t·ª´ng layer c·ªßa ki·∫øn tr√∫c n√†y (bronze -&gt; silver -&gt; gold)</p>
<figure><img src="https://www.databricks.com/sites/default/files/inline-images/building-data-pipelines-with-delta-lake-120823.png?v=1702318922"/>
</figure>
</div>
        </div>
    </div>
<h3 id="pyspark" class="headerLink">
    <a href="#pyspark" class="header-mark"></a>PySpark</h3><p><div class="details admonition question">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-question-circle fa-fw"></i>Apache Spark ƒë∆∞·ª£c set up ·ªü ƒë√¢u ?<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>C√≥ l·∫Ω b·∫°n s·∫Ω th·∫Øc m·∫Øc t·∫°i sao kh√¥ng th·∫•y Apache Spark ƒë∆∞·ª£c set up. c√≥ 2 l√Ω do:</p>
<ol>
<li>T√†i nguy√™n h·∫°n ch·∫ø: ƒë·ªëi v·ªõi project hi·ªán t·∫°i khi ƒë√£ c√≥ qu√° nhi·ªÅu services ƒë∆∞·ª£c ch·∫°y c√πng l√∫c b·ªüi docker containers, set up th√™m spark cluster c√≥ th·ªÉ s·∫Ω qu√° t·∫£i v√† kh√¥ng ƒë·ªß t√†i nguy√™n ƒë·ªÉ deploy t·∫•t c·∫£.</li>
<li>Data nh·ªè: th√†nh th·ª±c th√¨ s·ªë l∆∞·ª£ng data ph·∫£i process kh√¥ng th·ª±c s·ª± qu√° l·ªõn (kho·∫£ng h∆°n 200k quan s√°t) th√¨ vi·ªác s·ª≠ d·ª•ng spark c√≥ th·ªÉ s·∫Ω l√£ng ph√≠ t√†i nguy√™n. tuy nhi√™n v√¨ m·ª•c ƒë√≠ch h·ªçc t·∫≠p v√† th·ª±c hi·ªán project poc, ta s·∫Ω s·ª≠ d·ª•ng spark v·ªõi local mode thay v√¨ set up standardlone mode v·ªõi cluster</li>
</ol>
</div>
        </div>
    </div>
Apache Spark c√≥ nhi·ªÅu ch·∫ø ƒë·ªô ch·∫°y m√† ta c√≥ th·ªÉ t√πy v√†o quy m√¥ project m√† s·ª≠ d·ª•ng:</p>
<ul>
<li><code>local[*]</code>: l√† ch·∫ø ƒë·ªô <strong>local</strong>, ch·∫ø ƒë·ªô n√†y cho ph√©p ch·∫°y m√† kh√¥ng c·∫ßn ph·∫£i setup spark cluster</li>
<li><code>spark://{master-node-name}:7077</code>: ch·∫ø ƒë·ªô <strong>standalone</strong> v√† ta s·∫Ω k·∫øt n·ªëi v·ªõi m·ªôt spark cluster</li>
<li><code>yarn-client</code>: ch·∫ø ƒë·ªô <strong>yarn-client</strong></li>
<li><code>yarn-cluster</code>: ch·∫ø ƒë·ªô <strong>yarn-cluster</strong></li>
<li><code>mesos://host:5050</code>: <strong>mesos cluster</strong></li>
</ul>
<p>V√† ·ªü project n√†y ta s·∫Ω s·ª≠ d·ª•ng <strong>local</strong> mode ƒë·ªÉ t·ªëi ∆∞u t√†i nguy√™n c≈©ng nh∆∞ ph√π h·ª£p v·ªõi k√≠ch th∆∞·ªõc dataset. ƒë·ªÉ ti·ªán l·ª£i cho vi·ªác t·∫°o SparkSession, ta s·∫Ω vi·∫øt m·ªôt <code>sparkIO</code> b·∫±ng <code>contextlib</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkConf</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">SparkIO</span><span class="p">(</span><span class="n">conf</span><span class="p">:</span> <span class="n">SparkConf</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()):</span>
    <span class="n">app_name</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;spark.app.name&#34;</span><span class="p">)</span>
    <span class="n">master</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;spark.master&#34;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Create SparkSession app </span><span class="si">{</span><span class="n">app_name</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">master</span><span class="si">}</span><span class="s1"> mode&#39;</span><span class="p">)</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">spark</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Stop SparkSession app </span><span class="si">{</span><span class="n">app_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">spark</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>ƒëi·ªÅu n√†y gi√∫p ƒë∆°n gi·∫£n h√≥a vi·ªác t·∫°o sparksession v√† t·∫Øt spark tr·ªü n√™n ƒë∆°n gi·∫£n v√† tr√°nh thi·∫øu s√≥t</p>
<div class="details admonition tip">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>Ta c≈©ng c√≥ th·ªÉ l√†m t∆∞∆°ng t·ª± cho vi·ªác k·∫øt n·ªëi v·ªõi mongodb b·∫±ng c√°ch vi·∫øt m·ªôt <code>mongodb_io</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="kn">from</span> <span class="nn">pymongo.errors</span> <span class="kn">import</span> <span class="n">ConnectionFailure</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">MongodbIO</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;MONGODB_USER&#34;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;MONGODB_PASSWORD&#34;</span><span class="p">)</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;MONGODB_SRV&#34;</span><span class="p">)</span>
    <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;//&#34;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;mongodb+srv://</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">cluster</span><span class="si">}</span><span class="s2">/?retryWrites=true&amp;w=majority&#34;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;MongoDB Connected&#34;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">client</span>
    <span class="k">except</span> <span class="n">ConnectionFailure</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to connect with MongoDB&#34;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConnectionFailure</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Close connection to MongoDB&#34;</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></div>
        </div>
    </div>
<h3 id="data-processing" class="headerLink">
    <a href="#data-processing" class="header-mark"></a>Data Processing</h3><p>ta s·∫Ω x√¢y d·ª±ng hdfs theo ki·∫øn tr√∫c meddalion b·∫±ng c√°ch chia data quality th√†nh c√°ch v√πng (hay directory):</p>
<ul>
<li><strong>Bronze layer</strong>: d√πng ƒë·ªÉ ch·ªâ l∆∞u raw data</li>
<li><strong>Silver layer</strong>: l∆∞u data ƒë√£ x·ª≠ l√Ω m·ªôt ph·∫ßn (x·ª≠ l√Ω ki·ªÉu d·ªØ li·ªáu, x·ª≠ l√Ω ki·ªÉu array v√† c√°c c·∫•u tr√∫c l·ªìng ph·ª©c t·∫°p) t·ª´ Bronze Layer</li>
<li><strong>Gold layer</strong>: l∆∞u data ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch sau khi chu·∫©n h√≥a d·ªØ li·ªáu v√† l√†m s·∫°ch c√°c b·∫£ng m·ªõi t·ª´ Silver Layer</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/pipeline2-a.jpg"/>
</figure>

<h2 id="analytic-layer" class="headerLink">
    <a href="#analytic-layer" class="header-mark"></a>Analytic layer</h2><p>Nh∆∞ ƒë√£ setup t·ª´ tr∆∞·ªõc, ta s·∫Ω s·ª≠ d·ª•ng dremio nh∆∞ m·ªôt analytic layer ƒë·ªÉ c√≥ th·ªÉ ph√¢n t√≠ch tr√™n data s·∫°ch ·ªü gold layer trong HDFS. Vi·ªác ƒë∆°n gi·∫£n l√† ta ch·ªâ c·∫ßn k·∫øt n·ªëi dremio ƒë·∫øn HDFS qua dremio UI ·ªü <code>localhost:9047</code> v√† sau ƒë√≥ format file <code>.parquet</code> ·ªü th∆∞ m·ª•c <code>gold_layer</code> v√† ta c√≥ th·ªÉ vi·∫øt c√°c c√¢u l·ªánh sql query ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch ƒë∆∞·ª£c r·ªìi</p>
<figure><img src="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/dremio.jpg"/>
</figure>

<h2 id="machine-learning-and-dashboard" class="headerLink">
    <a href="#machine-learning-and-dashboard" class="header-mark"></a>Machine learning and Dashboard</h2><p>ƒê·∫øn ƒë√¢y c√≥ th·ªÉ coi nh∆∞ l√† k·∫øt th√∫c ph·∫ßn vi·ªác c·ªßa m·ªôt data engineer, ta s·∫Ω b·∫Øt ƒë·∫ßu c√°c tasks c·ªßa m·ªôt data scientist v√† data analyst trong vi·ªác x√¢y d·ª±ng m√¥ h√¨nh m√°y h·ªçc v√† x√¢y d·ª±ng report.</p>
<h3 id="k-nearest-neighbors-knn" class="headerLink">
    <a href="#k-nearest-neighbors-knn" class="header-mark"></a>K-Nearest Neighbors (KNN)</h3><p>Ta s·∫Ω x√¢y d·ª±ng m·ªôt m√¥ h√¨nh c√≥ th·ªÉ g·ª£i √Ω nh·∫°c d·ª±a tr√™n ƒë·ªô gi·ªëng nhau gi·ªØa c√°c features c·ªßa nh·ªØng b·∫£n nh·∫°c nh∆∞: ƒë·ªô l·ªõn, giai ƒëi·ªáu, th·ªÉ lo·∫°i, tempo, m·ª©c ƒë·ªô s√¥i ƒë·ªông,&hellip; ƒê·ªÉ l√†m ƒë∆∞·ª£c vi·ªác ƒë√≥ ta s·∫Ω s·ª≠ d·ª•ng m·ªôt m√¥ h√¨nh c√≥ th·ªÉ ƒë∆∞a ra ƒë∆∞·ª£c top k c√°c record kh√°c nhau t·ª´ danh s√°ch h√†ng trƒÉm ngh√¨n b√†i h√°t. ƒê√≥ l√† <strong>KNN</strong></p>
<p>KNN l√† m·ªôt m√¥ h√¨nh h·ªçc m√°y ƒë∆°n gi·∫£n gi√∫p ta t√¨m ƒë∆∞·ª£c top nh·ªØng ƒëi·ªÉm data g·∫ßn nh·∫•t v·ªõi v·ªã tr√≠ data point ƒë·∫ßu v√†o d·ª±a tr√™n kho·∫£ng c√°ch c·ªßa ch√∫ng trong kh√¥ng gian vector. Similarity Metric l·∫ßn n√†y ta s·ª≠ d·ª•ng s·∫Ω l√† ƒë·ªô t∆∞∆°ng t·ª± consine hay consine similarity</p>
<p>$$
S_C(A,B) = cos(\theta) = \frac{A \cdot B}{\Vert A\Vert \Vert B \Vert} = \frac{\sum^n_{i=1}A_iB_i}{\sqrt{\sum^n_{i=1}A^2} \cdot \sqrt{\sum^n_{i=1}B^2} }
$$</p>
<p>Ta s·∫Ω x√¢y d·ª±ng m·ªôt m√¥ h√¨nh g·ª£i √Ω top k c√°c b√†i h√°t gi·ªëng nh·∫•t v·ªõi b√†i h√°t l·ª±a ch·ªçn nh∆∞ sau:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">SongRecommendationSystem</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">knn_model</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>   
        <span class="n">matrix_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">matrix_table</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;select * from </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#34;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">recommend_songs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s1">&#39;home.searchs&#39;</span><span class="p">,</span> <span class="n">num_recommendations</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">song_library</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">track_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">song_library</span><span class="p">[</span><span class="s1">&#39;track_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Track &#34;</span><span class="si">{</span><span class="n">track_name</span><span class="si">}</span><span class="s1">&#34; not found in the dataset.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
            
        <span class="n">features_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table</span><span class="p">(</span><span class="s1">&#39;home.model&#39;</span><span class="p">)</span>
        <span class="n">track_index</span> <span class="o">=</span> <span class="n">song_library</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">song_library</span><span class="p">[</span><span class="s1">&#39;track_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">track_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knn_model</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">([</span><span class="n">features_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">track_index</span><span class="p">]],</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">num_recommendations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">song_library</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="p">:]</span>
</code></pre></td></tr></table>
</div>
</div><p>Khi th·ª≠ t√¨m c√°c b√†i h√°t gi·ªëng v·ªõi &ldquo;Something Just Like This&rdquo; (c√≥ v·∫ª c≈©ng ch∆∞a t·ªët l·∫Øm üòÇ)
<figure><img src="https://i.imgur.com/WJAw1xZ.jpeg"/>
</figure>
</p>
<h3 id="powerbi-dashboard" class="headerLink">
    <a href="#powerbi-dashboard" class="header-mark"></a>PowerBI Dashboard</h3><p>Khi c√≥ r·∫•t nhi·ªÅu data s·∫°ch, ƒëi·ªÅu ti·∫øp theo ta c√≥ th·ªÉ nghƒ© ƒë·∫øn ch√≠nh l√† l√†m sao th·∫•y ƒë∆∞·ª£c nhi·ªÅu insight gi√° tr·ªã nh·∫•t t·ª´ data ƒë√≥. ƒê√¢y l√† l√∫c ta c√≥ th·ªÉ d√πng PowerBI ƒë·ªÉ x√¢y d·ª±ng Dashboard t·ª´ Dremio</p>
<figure><img src="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/powerbi-dash.jpg"/>
</figure>

<h2 id="application" class="headerLink">
    <a href="#application" class="header-mark"></a>Application</h2><p>Cu·ªëi c√πng, ta c√≥ th·ªÉ x√¢y d·ª±ng m·ªôt ·ª©ng d·ª•ng ƒë∆°n gi·∫£n ƒë·ªÉ ·ª©ng d·ª•ng m√¥ h√¨nh machine learning c≈©ng nh∆∞ nh∆∞ t√≠ch h·ª£p Dashboard v√†o trong ·ª©ng d·ª•ng n√†y nh∆∞ m·ªôt portal to√†n di·ªán. Ta s·∫Ω s·ª≠ d·ª•ng Streamlit ƒë·ªÉ x√¢y d·ª±ng m·ªôt web app ƒë∆°n gi·∫£n</p>
<figure><img src="https://raw.githubusercontent.com/PhongHuynh0394/Spotify-Analysis-with-PySpark/refs/heads/main/image/ui.jpg"/>
</figure>

<h2 id="final-thoughts" class="headerLink">
    <a href="#final-thoughts" class="header-mark"></a>Final Thoughts</h2><p>Project ch·ªâ mang t√≠nh ch·∫•t h·ªçc t·∫≠p, do ƒë√≥ ƒë·ªô l·ªõn c·ªßa data hay m·ªôt s·ªë ki·∫øn tr√∫c set up c√≥ th·ªÉ ch∆∞a ho√†n ch·ªânh. Tuy nhi√™n ƒë√¢y v·∫´n l√† m·ªôt c·ªôt m·ªëc ƒë√°ng nh·ªõ trong h√†nh tr√¨nh h·ªçc t·∫≠p c·ªßa OG. Hy v·ªçng n√≥ s·∫Ω gi√∫p √≠ch cho c√°c b·∫°n tham kh·∫£o üòÑ</p>
<p><strong>-Meww-</strong></p>
<hr>
<h1 id="related" class="headerLink">
    <a href="#related" class="header-mark"></a>Related</h1>
<div class="showcase-box column-2">
    <div class="showcase-image">
        <a href=/stock_analysis/><img
        
        loading="lazy"
        src="/img/projects-stock.jpg"
        srcset="/img/projects-stock.jpg, /img/projects-stock.jpg 1.5x, /img/projects-stock.jpg 2x"
        sizes="auto"
        alt="Stock Analysis"
        title="Stock Analysis" height="200"   width="400" ></a>
    </div>
    <h2 class="showcase-title">
        <a href=/stock_analysis/>Stock Analysis</a>
    </h2>
    <p class="showcase-summary">
        Basic analyzing vn30 stock using pca and k-means
    </p>
    <a class="showcase-link" href=/stock_analysis/>
        Read more...
    </a>
</div>

<div class="showcase-box column-2">
    <div class="showcase-image">
        <a href=/football_etl/><img
        
        loading="lazy"
        src="/img/projects-football.jpg"
        srcset="/img/projects-football.jpg, /img/projects-football.jpg 1.5x, /img/projects-football.jpg 2x"
        sizes="auto"
        alt="Football ETL Analysis"
        title="Football ETL Analysis" height="200"   width="400" ></a>
    </div>
    <h2 class="showcase-title">
        <a href=/football_etl/>Football ETL Analysis</a>
    </h2>
    <p class="showcase-summary">
        A Data Engineer project building pipeline to analyze football data
    </p>
    <a class="showcase-link" href=/football_etl/>
        Read more...
    </a>
</div></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 10 Dec 2023</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><button title="Share on Facebook" data-sharer="facebook" data-url="https://phonghuynh.netlify.app/spotify_analysis/" data-hashtag="streamlit"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on Linkedin" data-sharer="linkedin" data-url="https://phonghuynh.netlify.app/spotify_analysis/"><span class="fab fa-linkedin fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/streamlit/">streamlit</a>,&nbsp;<a href="/tags/api/">API</a>,&nbsp;<a href="/tags/elt/">ELT</a>,&nbsp;<a href="/tags/data-engineer/">data engineer</a>,&nbsp;<a href="/tags/machine-learning/">Machine Learning</a>,&nbsp;<a href="/tags/distributed-system/">Distributed System</a>,&nbsp;<a href="/tags/hadoop/">Hadoop</a>,&nbsp;<a href="/tags/spark/">Spark</a>,&nbsp;<a href="/tags/docker/">docker</a>,&nbsp;<a href="/tags/terraform/">Terraform</a>,&nbsp;<a href="/tags/visualization/">Visualization</a>,&nbsp;<a href="/tags/powerbi/">PowerBI</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/spotify_analysis_en/" class="prev" rel="prev" title="Spotify Analysis"><i class="fas fa-angle-left fa-fw"></i>Spotify Analysis</a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">OG</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":30,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>